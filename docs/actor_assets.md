# Actor Asset File Format

Actor assets are scheme files, which resolve to a specific data structure declaring various properties and information about the actor. Actor assets are all files that match any of the `actors` globs from the project's assets definition. The name of the asset is the name of the file *without* the file extension.

Every actor asset must be complemented by a matching [`actor_definition!`](actor_definition.md) call in Rust, and the result must be visible (e.g. through `use`) to the `mod` marked with the `#[skylite_project(...)]` attribute.

The root element of an actor asset is an associative list ('alist') with the following keys:

```scheme
'(
  ; List of the actions and their parameters. This is required and
  ; must include at least one action to serve as the initial-action.
  (actions . (...))

  ; List of parameters for the actor. These are different from
  ; the actor's properties.
  (parameters . (...))

  ; The action with which this actor starts after it is instantiated.
  (initial-action . (...)))
```

The meaning of each of these keys is described in the following sections.

## `actions`: Declaring Actions

Actions are declared as a lists containing the following elements:

1. The action's name as a symbol.
2. The list of the actions parameters, which are in turn declared as lists: The first datum of a parameter declaration is the name of the parameter as a symbol, followed by the parameter's type and an optional documentation string. The type of the parameter must be one of the following:
   - A symbol denoting a primitive type: `u8`, `u16`, `u32`, `u64`, `i8`, `i16`, `i32`, `i64`, `f32`, `f64`, `bool`, `string`
   - A vector over another type, e.g. `(vec <type>)`.
   - A tuple over other types, e.g. `(<type0> <type1> <type2>)`.

   Vectors and tuples can be nested.

   An example declaration of the parameter `dx` of type `i8`:

   ```scheme
   (dx i8 "change in x-coordinate")
   ```
3. A description of the action.

The various descriptions will be added as a documentation to the code generated by `actor_definition`.

Only the action's name is required, the parameter list and description can be omitted. Note that to add a description to an action that does not take parameters, an empty list still has to be provided.

Here is an example of a single action:

```scheme
(move
  ( (dx i8 "change in x-coordinate")
    (dy i8 "change in y-coordinate"))
  "Moves the actor by the given amount each update.")
```

The action's name is `move` and it takes two parameters `dx` and `dy`, both of type `i8`.

## `parameters`: Declaring Parameters

Parameters can be used to initialize the properties of an actor instance. There need not be a one-to-one relationship between parameters and properties, instead the properties are initialized by the [`skylite_proc::create_properties`](#special-functions-and-macros) special function in the body of the `actor_definition`. This function can contain arbitrary code, as long as it produced an instance of the actor's property type at the end.

Parameters for the actor are declared the same way as parameters for [actions](#declaring-actions): First the parameter's name, followed by its type and then an optional description. The order in which the parameters are declared is important, as the signature of the `skylite_proc::create_properties` special function has to match this order.

## `initial-action`: Setting the Initial Action

Actors are always performing an actions. The action in which an actor starts after instantiation is given by its initial action. The initial action is defined as a list starting with the name of the action as a symbol, followed by arguments for each of the action's parameters. The order of these arguments must match the order in which the parameters of the action were declared.

Example: `(move -2 1)`

## Complete Example

Let's put everything together in order to build a complete actor asset:

```scheme
; actors/my_actor.scm:

'((actions .
    ; Define three actions, 'move', 'idle' and 'set-position'.
    ((move ((dx i8 "change in x-coordinate")
            (dy i8 "change in y-coordinate"))
           "Moves the actor by the given amount each update.")

     ; This action does not take any parameters and has no description.
     (idle)

     (set-position ((x i16) (y i16))
                   "Moves the actor to the given position, then idles.")))

  (parameters .
    ; Define two parameters, 'x' and 'y'
    ((x i16 "initial x-coordinate")
     (y i16 "initial y-coordinate")))

  ; Start the actor in the 'idle' action, which takes no parameters.
  (initial-action . (idle)))
```
